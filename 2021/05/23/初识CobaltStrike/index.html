<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title itemprop="name">初识CobaltStrike | Troy3e</title>
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC" media="all">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="/css/lib.min.css" media="all">
  <link rel="stylesheet" href="/css/font.css" media="all">
  <link rel="stylesheet" href="/css/insight.css" media="all">
  <link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="/css/zoom.css" media="all">
  <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
   * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "YukinoTroy3e";
  mashiro_option.author_name = "Troy3e";
  mashiro_option.site_url = "https://sakura.hojun.cn";
  mashiro_option.v_appId = "kEnVX5WKqd0JPt4srHAJkgsC-gzGzoHsz";
  mashiro_option.v_appKey = "h05kFRgBHS516pQ6vIsYtG1B";
  mashiro_option.mathjax = "0";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
  var bg = "https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/thumb-1920-972788.jpg,https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/nfsgnftn.jpg,https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/thumb-1920-994295.png".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('朋友，IE浏览器未适配哦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;}.author-profile i,.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}
  </style>
</head>
</html>
<script src="https://cdn.jsdelivr.net/gh/wallleap/cdn/js/sakura.js"></script>
<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop ">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a href="https://sakura.hojun.cn">
          <img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/215153415.png">
        </a>
      </div>
      <div class="header-info">
        <p>Troy3e-blog</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="https://space.bilibili.com/129300391" target="_blank" class="social-github" title="bilibili">
                    <img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/1188649.jpg">
                  </a>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono">Yukino</span>
            <span class="shironeko">Troy3e</span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    归档
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                  </ul>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

  <div class="pattern-center single-center">
    <!-- 有配图默认渲染第一张 -->
    <div class="pattern-attachment-img lazyload" style="background-image: url(https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/thumb-1920-1147728.png);" src="/blogpictures/20160708223941_YQncj.jpeg" data-src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/thumb-1920-1147728.png">
    </div>
    <header class="pattern-header single-header">
      <h1 class="entry-title">
      初识CobaltStrike</h1>
      <p class="entry-census">
        <span>
          <a href="">
            <img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/QQ%E5%9B%BE%E7%89%8720210427144151.jpg">
          </a>
        </span>
        <span>
          <a href="">Troy3e</a>
        </span>
        <span class="bull">
        ·</span>
        2021-5-23<span class="bull">
        ·</span>
      <span id="busuanzi_value_page_pv"></span>次阅读</p>
    </header>
  </div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- 套嵌目录使用（主要为了支援评论）-->
        
        <div class="entry-content">
          <p>好久没更新博客了，这几星期感觉做了很多事情，又感觉什么事都没干。又想挖洞，又想往开发方向发展，比赛也零零碎碎打了不少。<br>马上就要被拉去做hvv免费苦力了，在这之前学习一下CS神器的使用。</p>
<h2 id="CobaltStrike是什么"><a href="#CobaltStrike是什么" class="headerlink" title="CobaltStrike是什么"></a>CobaltStrike是什么</h2><p>CobaltStrike是一款渗透测试神器，被业界人称为CS神器。CobaliSitike分为客户端与服务端，服务端是一个，客户端可以有多个，可被团队进行分布式协团操作。<br>Cobaltsitrike集成了端口转发、服务扫描，自动化溢出，多模式端口监听，windows exe木马生成，windows dl木马生成，java木马生成，office宏病毒生成，木马捆绑。钓鱼攻击包括:站点克隆，目标信息获取，java执行，浏览器自动攻击等等。</p>
<h2 id="CobaltStrike的安装"><a href="#CobaltStrike的安装" class="headerlink" title="CobaltStrike的安装"></a>CobaltStrike的安装</h2><p>我采用的是最近刚放出来的4.3的破解版。</p>
<p>链接：<a href="https://pan.baidu.com/s/1Kzv0fRcYthoP2QYHq98vTw" target="_blank" rel="noopener">https://pan.baidu.com/s/1Kzv0fRcYthoP2QYHq98vTw</a><br>提取码：tvmy<br>来源于某公众号，使用后造成的风险自行承担。<br>链接挂了的话。。。挂了就挂了，应该也没人看我博客。<br>一、服务端<br>团队服务器最好搭在linux服务器上。</p>
<p><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/20210523234100.png" alt></p>
<p>没什么环境要求，jdk8即可。<br>启动命令：<br>./teamserver 你的ip 你的密码</p>
<p><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/20210523234508.png" alt><br>上图所示便是成功启动。<br>端口默认50050，云服务器记得手动去控制台开一下。<br>如果你这里报错的话，请检查：<br>1、java版本是否正确（请使用jdk8）<br>2、是否更改了teamserver里的文件，比如修改了密码。这里说明一下，文件里的密码123456是不能更改的。密码直接在命令里指定即可。</p>
<p>二、客户端<br>客户端我个人认为还是windows比较方便些，直接双击exe运行即可：</p>
<p><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/20210523235042.png" alt></p>
<p>按你自己配置的信息写入。</p>
<p><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/20210523235121.png" alt></p>
<h2 id="目录信息及参数说明"><a href="#目录信息及参数说明" class="headerlink" title="目录信息及参数说明"></a>目录信息及参数说明</h2><p>CobaltStrike—些主要文件功能如下:</p>
<pre><code>agscript:扩展应用的脚本
c2lint:用于检查profile的错误和异常
teamserver:服务器端启动程序
cobaltstrike.jar: CobaltStrike核心程序
cobaltstrike.auth:用于客户端和服务器端认证的文件，客户端和服务端有一个一模一样的
cobaltstrike.store:秘钥证书存放文件
</code></pre><p>—些目录作用如下:</p>
<pre><code>data:用于保存当前TeamServer的一些数据
download:用于存放在目标机器下载的数据
upload: 上传文件的目录
logs:日志文件，包括Web日志、Beacon日志、截图日志、下载日志、键盘记录日志等
third-party:第三方工具目录
</code></pre><p><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/20210523235500.png" alt></p>
<p>Cobalt Strike</p>
<pre><code>New Connection   # 新建连接，支持连接多个服务器端
Preferences   # 设置Cobal Strike界面、控制台、以及输出报告样式、TeamServer连接记录
Visualization   # 主要展示输出结果的视图
VPN Interfaces   # 设置VPN接口
Listenrs   # 创建监听器
Script Manager   # 脚本管理，可以通过AggressorScripts脚本来加强自身，能够扩展菜单栏，Beacon命令行，提权脚本等
Close   # 退出连接
</code></pre><p>View</p>
<pre><code>Applications   # 显示受害主机的应用信息
Credentials   # 显示所有以获取的受害主机的凭证，如hashdump、Mimikatz
Downloads   # 查看已下载文件
Event Log   # 主机上线记录以及团队协作聊天记录
Keystrokes   # 查看键盘记录结果
Proxy Pivots   # 查看代理模块
Screenshots   # 查看所有屏幕截图
Script Console   # 加载第三方脚本以增强功能 
Targets   # 显示所有受害主机
Web Log    # 所有Web服务的日志
</code></pre><p>Attacks<br>Packages</p>
<pre><code>HTML Application   # 生成(executable/VBA/powershell)这三种原理实现的恶意HTA木马文件
MS Office Macro   # 生成office宏病毒文件
Payload Generator   # 生成各种语言版本的payload
USB/CD AutoPlay   # 生成利用自动播放运行的木马文件
Windows Dropper   # 捆绑器能够对任意的正常文件进行捆绑(免杀效果差)
Windows Executable   # 生成可执行exe木马
Windows Executable(Stageless)   # 生成无状态的可执行exe木马
</code></pre><p>Web Drive-by</p>
<pre><code>Manage   # 对开启的web服务进行管理
Clone Site   # 克隆网站，可以记录受害者提交的数据
Host File   # 提供文件下载，可以选择Mime类型
Scripted Web Delivery   # 为payload提供web服务以便下载和执行，类似于Metasploit的web_delivery 
Signed Applet Attack   # 使用java自签名的程序进行钓鱼攻击(该方法已过时)
Smart Applet Attack   # 自动检测java版本并进行攻击，针对Java 1.6.0_45以下以及Java 1.7.0_21以下版本(该方法已过时)
System Profiler   # 用来获取系统信息，如系统版本，Flash版本，浏览器版本等
Spear Phish   # 鱼叉钓鱼邮件
</code></pre><p>Reporting</p>
<pre><code>Activity Report   # 活动报告
Hosts Report   # 主机报告
Indicators of Compromise   # IOC报告：包括C2配置文件的流量分析、域名、IP和上传文件的MD5 hashes
Sessions Report   # 会话报告
Social Engineering Report   # 社会工程报告：包括鱼叉钓鱼邮件及点击记录
Tactics, Techniques, and Procedures   # 战术技术及相关程序报告：包括行动对应的每种战术的检测策略和缓解策略
Reset Data   # 重置数据
Export Data   # 导出数据，导出.tsv文件格式
</code></pre><p>Help</p>
<pre><code>Homepage   # 官方主页
Support   # 技术支持
Arsenal   # 开发者
System information   # 版本信息
About   # 关于
</code></pre><h2 id="CobaltStrike的使用"><a href="#CobaltStrike的使用" class="headerlink" title="CobaltStrike的使用"></a>CobaltStrike的使用</h2><p>一、创建监听器Listener<br>点击Cobalt Strike选择listeners，点击下方的add</p>
<p><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/20210524132747.png" alt></p>
<pre><code>name：为监听器名字，可任意
payload：payload类型
HTTP Hosts: shell反弹的主机，也就是我们kali的ip
HTTP Hosts(Stager): Stager的马请求下载payload的地址
HTTP Port(C2): C2监听的端口
</code></pre><p>Beacon为内置的Listener，即在目标主机执行相应的payload，获取shell到CS上;其中包含DNS、HTTP、HTTPS、SMB。Beacon可以选择通过DNS还是HTTP协议出口网络，你甚至可以在使用Beacon通讯过程中切换HTTP和DNS。其支持多主机连接，部署好Beacon后提交一个要连回的域名或主机的列表，Beacon将通过这些主机轮询。目标网络的防护团队必须拦截所有的列表中的主机才可中断和其网络的通讯。通过种种方式获取she以后（(比如直接运行生成的exe)，就可以使用Beacon了。<br>Foreign为外部结合的Listener，常用于MSF的结合，例如获取meterpreter到MSF上。</p>
<p>二、创建攻击Attacks<br>这里Attacks有几种，如下：</p>
<p>· HTML Application 　　　　　　 生成一个恶意HTML Application木马，后缀格式为 .hta。通过HTML调用其他语 言的应用组件进行攻击，提供了 可执行文件、PowerShell、VBA三种方法。</p>
<p>· MS Office Macro 　　　　　　 生成office宏病毒文件；</p>
<p>· Payload Generator 　　　　　 生成各种语言版本的payload，可以生成基于C、C#、COM Scriptlet、Java、Perl、 PowerShell、Python、Ruby、VBA等的payload</p>
<p>· Windows Executable 　　　　　生成32位或64位的exe和基于服务的exe、DLL等后门程序</p>
<p>· Windows Executable(S)　　　　用于生成一个exe可执行文件，其中包含Beacon的完整payload，不需要阶段性的请求。与Windows Executable模块相比，该模块额外提供了代理设置，以便在较为苛刻的环境中进行渗透测试。该模块还支持powershell脚本，可用于将Stageless Payload注入内存</p>
<p>Windows Executable</p>
<p><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/20210524132901.png" alt></p>
<p>双击生成的程序，记得把windows自带的保护关掉</p>
<p><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/20210524133240.png" alt></p>
<h2 id="对被控主机的操作"><a href="#对被控主机的操作" class="headerlink" title="对被控主机的操作"></a>对被控主机的操作</h2><pre><code>Interact       打开beacon
Access 
    dump hashes   获取hash
    Elevate       提权
    Golden Ticket 生成黄金票据注入当前会话
    MAke token    凭证转换
    Run Mimikatz  运行 Mimikatz 
    Spawn As      用其他用户生成Cobalt Strike的beacon
Explore
    Browser Pivot 劫持目标浏览器进程
    Desktop(VNC)  桌面交互
    File Browser  文件浏览器
    Net View      命令Net View
    Port scan     端口扫描
    Process list  进程列表
    Screenshot    截图
Pivoting
    SOCKS Server 代理服务
    Listener     反向端口转发
    Deploy VPN   部署VPN
Spawn            新的通讯模式并生成会话
Session          会话管理，删除，心跳时间，退出，备注
</code></pre><p>一、命令说明<br>beacon处输入help：</p>
<pre><code>Beacon Commands
===============
Command                   Description
-------                   -----------
argue                     进程参数欺骗
blockdlls                 在子进程中阻止非Microsoft的DLLs文件
browserpivot              注入受害者浏览器进程
bypassuac                 绕过UAC
cancel                    取消正在进行的下载
cd                        切换目录
checkin                   强制让被控端回连一次
clear                     清除beacon内部的任务队列
connect                   通过TCP连接到Beacon
covertvpn                 部署Covert VPN客户端
cp                        复制文件
dcsync                    从DC中提取密码哈希
desktop                   远程VNC
dllinject                 反射DLL注入进程
dllload                   使用LoadLibrary将DLL加载到进程中
download                  下载文件
downloads                 列出正在进行的文件下载
drives                    列出目标盘符
elevate                   尝试提权
execute                   在目标上执行程序(无输出)
execute-assembly          在目标上内存中执行本地.NET程序
exit                      退出beacon
getprivs                  对当前令牌启用系统权限
getsystem                 尝试获取SYSTEM权限
getuid                    获取用户ID
hashdump                  转储密码哈希值
help                      帮助
inject                    在特定进程中生成会话
jobkill                   杀死一个后台任务
jobs                      列出后台任务
kerberos_ccache_use       从ccache文件中导入票据应用于此会话
kerberos_ticket_purge     清除当前会话的票据
kerberos_ticket_use       从ticket文件中导入票据应用于此会话
keylogger                 键盘记录
kill                      结束进程
link                      通过命名管道连接到Beacon
logonpasswords            使用mimikatz转储凭据和哈希值
ls                        列出文件
make_token                创建令牌以传递凭据
mimikatz                  运行mimikatz
mkdir                     创建一个目录
mode dns                  使用DNS A作为通信通道(仅限DNS beacon)
mode dns-txt              使用DNS TXT作为通信通道(仅限D beacon)
mode dns6                 使用DNS AAAA作为通信通道(仅限DNS beacon)
mode http                 使用HTTP作为通信通道
mv                        移动文件
net                       net命令
note                      给当前目标机器备注       
portscan                  进行端口扫描
powerpick                 通过Unmanaged PowerShell执行命令
powershell                通过powershell.exe执行命令
powershell-import         导入powershell脚本
ppid                      为生成的post-ex任务设置父PID
ps                        显示进程列表
psexec                    使用服务在主机上生成会话
psexec_psh                使用PowerShell在主机上生成会话
psinject                  在特定进程中执行PowerShell命令
pth                       使用Mimikatz进行传递哈希
pwd                       当前目录位置
reg                       查询注册表
rev2self                  恢复原始令牌
rm                        删除文件或文件夹
rportfwd                  端口转发
run                       在目标上执行程序(返回输出)
runas                     以另一个用户权限执行程序
runasadmin                在高权限下执行程序
runu                      在另一个PID下执行程序
screenshot                屏幕截图
setenv                    设置环境变量
shell                     cmd执行命令
shinject                  将shellcode注入进程
shspawn                   生成进程并将shellcode注入其中
sleep                     设置睡眠延迟时间
socks                     启动SOCKS4代理
socks stop                停止SOCKS4
spawn                     生成一个会话 
spawnas                   以其他用户身份生成会话
spawnto                   将可执行程序注入进程
spawnu                    在另一个PID下生成会话
ssh                       使用ssh连接远程主机
ssh-key                   使用密钥连接远程主机
steal_token               从进程中窃取令牌
timestomp                 将一个文件时间戳应用到另一个文件
unlink                    断开与Beacon的连接
upload                    上传文件
wdigest                   使用mimikatz转储明文凭据
winrm                     使用WinRM在主机上生成会话
wmi                       使用WMI在主机上生成会话
</code></pre><p>二、提权<br>右键-&gt;Access-&gt;Elevate</p>
<p>我这里因为是win10，自带的两个payload都不能成功提权。</p>
<p>若提权成功，会返回来一个管理员的shell。<br>当然我这里还是返回了一个普通权限：</p>
<p><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/20210524134546.png" alt></p>
<p>三、抓取hash和dump明文密码</p>
<p>右键-&gt;Access-&gt;DumpHashes<br>利用mimikatz抓取明文密码：右键-&gt;Access-&gt;Run Mimikatz</p>
<p>抓取密码哈希，也可以直接输入hashdump<br>使用mimikatz抓取明文密码，也可以直接输入logonpasswords</p>
<p>抓取完之后点击凭证信息，就会显示我们抓取过的哈希或明文。由于我没有管理员权限，所以并没有尝试。</p>
<p>四、利用被控主机建立Socks4代理</p>
<p>当我们控制的主机是一台位于公网和内网边界的服务器，我们想利用该主机继续对内网进行渗透，于是，我们可以利用CS建立socks4A代理</p>
<p><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/20210524135243.png" alt></p>
<p><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/20210524135329.png" alt></p>
<p>然后vim /etc/proxychains.conf ，在文件末尾添加socks4代理服务器</p>
<p>socks4 服务端ip 9071<br>使用proxychains代理扫描内网主机<br>proxychains nmap -sP x.x.x.x/24</p>
<p>我们还可以通过隧道将整个msf带进目标内网<br>点击View-&gt;Proxy Pivots，选择Socks4a Proxy,点击Tunnel:</p>
<p><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/20210524135810.png" alt></p>
<p>打开msf对内网进行扫描</p>
<p><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/20210524135924.png" alt></p>
<p>关闭socks<br>beacon&gt;socks stop</p>
<p>五、注入进程、键盘监控<br>右键被控主机-&gt;Explore-&gt;Process List</p>
<p><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/20210524140801.png" alt></p>
<p>即可列出进程列表</p>
<p>kill为杀死该进程，refresh为刷新该进程，inject则是把beacon注入进程，log keystrokes为键盘记录，screenshot为截图，stea token为窃取运行指定程序的用户令牌</p>
<p>1、Inject注入进程<br>选择进程，点击Inject，随后选择监听器，点击choose，即可发现CobaltStrike弹回了目标机的一个新会话，这个会话就是成功注入到某进程的beacon会话。该功能可以把你的beacon会话注入到另外—个程序之中，注入之后，除非那个正常进程被杀死了，否则我们就一直可以控制该主机了。</p>
<p>inject  进程PID  进程位数  监听</p>
<p>单击一个进程，单击inject，选择监听器，就会弹回来beacon。</p>
<p>2、键盘记录<br>任意选择一个进程，点击log keystrokes，即可监听该主机的键盘记录</p>
<p>keylogger 进程PID 进程位数</p>
<p><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/20210524141629.png" alt></p>
<p>(硬核打码.jpg</p>
<p>查看键盘记录结果需要点击上面那个钥匙按钮。注意这里是监听所有的键盘记录，而不只是选中进程的键盘记录。</p>
<p>六、浏览器代理Browser Pivot<br>使用浏览器代理功能，我们可以注入到目标机器的浏览器进程中。然后在本地浏览器中设置该代理，这样，我们可以在本地浏览器上访问目标机器浏览器已经登录的网站，而不需要登录。但是目前浏览器代理只支持IE浏览器。如下，目标主机的IE浏览器目前在访问fofa，并且已登录。现在我们想利用浏览器代理在本地利用目标主机身份进行访问。</p>
<p>explore-&gt;Browser Pivot<br>随便选一个进程，点击开始。<br><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/20210524142214.png" alt></p>
<p>然后视图代理信息可以看到刚刚建立的浏览器代理。这里的意思是，TeamServer监听59398和26193端口。流程是这样，我们将流量给59398端口，59398端口将流量给26193端口，26193将流星给目标主机的26193端口。</p>
<p><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/20210524142546.png" alt></p>
<p>这里懒得试了，放个图。</p>
<p>七、生成黄金票据注入当前会话（Golden Ticket）<br>暂略。</p>
<p>八、凭证转换<br>暂略。</p>
<p>九、端口扫描</p>
<pre><code>portscan 192.168.10.1-192.168.10.10 22,445 arp  1024
portscan 192.168.10.1-192.168.10.10 22,445 icmp 1024
portscan 192.168.10.1-192.168.10.10 22,445 none 1024

一般我们直接运行命令
portscan 192.168.1.0/24 22,445,1433,3306
</code></pre><p>十、哈希传递攻击或SSH远程登录<br>暂略。</p>
<p>十一、还有很多，暂时不写了</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>还没写完，有空继续学。</p>

        </div>
        <!-- .entry-content -->
        <div class="single-reward">
          <div class="reward-open">赏
            <div class="reward-main">
              <ul class="reward-row">
                <li class="alipay-code"><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picturenull"></li>
                <li class="wechat-code"><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/wechat.jpg"></li>
              </ul>
            </div>
          </div>
        </div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
        
          
            <div class="post-nepre full next">
          
            <a href="/2021/05/13/Java-Web安全/" rel="next">
              <div class="background">
                <img class="lazyload" src="/blogpictures/20160708223941_YQncj.jpeg" data-src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/thumb-1920-1142868.png" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/thumb-1920-1142868.png">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                Java Web学习</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      
<div id="vcomments"></div>
<script>
  window.onload = function(){
      var valine = new Valine();
      valine.init({
        el: '#vcomments',
        appId: "kEnVX5WKqd0JPt4srHAJkgsC-gzGzoHsz",
        appKey: "h05kFRgBHS516pQ6vIsYtG1B",
        path: window.location.pathname,
        placeholder: "你是我一生只会遇见一次的惊喜 ..."
      })
  }
</script>

      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <a href="" class="profile gravatar"><img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/QQ%E5%9B%BE%E7%89%8720210427144151.jpg" itemprop="image" alt="Troy3e" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="" itemprop="url" rel="author">Troy3e</a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i>SteamID：888007034</p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>



    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            // PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Troye<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/wordpress-rotating-ball-o.svg">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2018</p>
    </div>
    <div class="footer-device">
    <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;">Theme <a href="https://github.com/honjun/hexo-theme-sakura" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Sakura</a> <i class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> by <a href="https://2heng.xin/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Mashiro</a>&<a href="https://www.hojun.cn/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hojun</a>, Powered by Hexo, Hosted by Coding Pages</a>
        </span>
      </p>
    </div>
  </div><!-- .site-info -->
</footer>



<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine@1.3.4/dist/Valine.min.js'></script>
<script src="/js/botui.js"></script>
<!-- 不蒜子 网页计数器 -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
/* <![CDATA[ */
if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  var Poi = {"pjax":"1","movies":{"url": "https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures","name":"love.mp4","live":"close"},"windowheight":"fixed","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
} else {
  var Poi = {"pjax":"1","movies":{"url": "https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures","name":"love.mp4","live":"open"},"windowheight":"auto","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
}
/* ]]> */

</script>
<script>
$(document).ready(function() {
  if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
    if ($(".pattern-center").length > 0) { //有图的情况
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -400,
          scrollSmoothOffset: -85
      });
    } else {
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -85,
          scrollSmoothOffset: -85
      });
    }
    var offsetTop = $('.toc').offset().top - 95;
    window.onscroll = function() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
      if (scrollTop >= offsetTop) {
        $('.toc').addClass('toc-fixed');
      } else {
        $('.toc').removeClass('toc-fixed');
      }
    }
  }
});
</script>

    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://cdn.jsdelivr.net/gh/ITroyeSivan/picture/blogpictures/215153415.png">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">YukinoTroy3e</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="http://github.com/honjun" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
        <a href="http://weibo.com/mashirozx?is_all=1" class="fa fa-weibo" target="_blank" style="color: #dd4b39; margin-left:20px"></a>
      
        <a href="https://wpa.qq.com/msgrd?v=3&uin=954655431&site=qq&menu=yes" class="fa fa-qq" target="_blank" style="color: #25c6fe; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            归档
          </span>
        </a>
        
          <ul class="sub-menu">
            
          </ul>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<meting-js

    id="819057276"

    server="netease"

    type="playlist"

    fixed="true"

    autoplay="false"

    loop="all"

    order="list"

    preload="auto"

    volume="0.7"

    mutex="true"

    listFolded="false"

</meting-js>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script>
</body>
</html>